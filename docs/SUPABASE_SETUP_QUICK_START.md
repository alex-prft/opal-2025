# ðŸš€ OSA Supabase Setup - Quick Start Guide\n\nThis guide will get your Supabase database set up with all the guardrails tables and test data in just a few minutes.\n\n## ðŸ“‹ **Prerequisites**\n\n1. **Supabase Project**: https://supabase.com/dashboard/project/runniojabssuzfgysbtf\n2. **Service Role Key**: Get this from your Supabase project settings\n3. **Node.js**: Version 20+ installed\n\n## âš¡ **Quick Setup (2 Minutes)**\n\n### **Step 1: Get Your Supabase Credentials**\n\n1. Go to: https://supabase.com/dashboard/project/runniojabssuzfgysbtf/settings/api\n2. Copy these values:\n   - **Project URL**: `https://runniojabssuzfgysbtf.supabase.co`\n   - **Service Role Key**: `eyJ...` (the long secret key)\n\n### **Step 2: Configure Environment**\n\nCreate or update your `.env.local` file:\n\n```bash\n# Required Supabase Configuration\nSUPABASE_URL=https://runniojabssuzfgysbtf.supabase.co\nNEXT_PUBLIC_SUPABASE_URL=https://runniojabssuzfgysbtf.supabase.co\nSUPABASE_SERVICE_ROLE_KEY=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...  # Your actual service role key\n\n# Guardrails Configuration\nSUPABASE_GUARDRAILS_ENABLED=true\nDATA_GOVERNANCE_ENABLED=true\nAUDIT_LOGGING_ENABLED=true\nPII_SCANNING_ENABLED=true\n```\n\n### **Step 3: Run Automatic Setup**\n\n```bash\n# Install dependencies (if you haven't already)\nnpm install\n\n# Set up Supabase database with all tables and test data\nnpm run supabase:setup\n\n# âœ… This will:\n# - Test your Supabase connection\n# - Create all necessary tables\n# - Apply security triggers\n# - Insert test data\n# - Verify everything works\n```\n\n### **Step 4: Verify Setup**\n\n```bash\n# Test the complete integration\nnpm run guardrails:test\n\n# Check your Supabase dashboard\nopen https://supabase.com/dashboard/project/runniojabssuzfgysbtf/editor\n```\n\n## ðŸŽ¯ **What You Should See**\n\nAfter running the setup, your Supabase dashboard should show these tables:\n\n### **ðŸ“Š Core Tables**\n- âœ… `supabase_audit_log` - Audit and compliance logging\n- âœ… `opal_configurations` - System configuration data\n- âœ… `opal_agent_configs` - OPAL agent settings\n- âœ… `opal_workflow_executions` - Workflow execution history\n- âœ… `session_states` - User session management\n- âœ… `anonymous_usage_metrics` - Anonymous analytics data\n- âœ… `temporary_workflow_data` - Temporary processing data\n- âœ… `compliance_reports` - Generated compliance reports\n- âœ… `data_retention_backups` - Backup tracking\n\n### **ðŸ›¡ï¸ Security Features**\n- âœ… **PII Detection Triggers** - Automatically block sensitive data\n- âœ… **Data Classification** - Automatic categorization\n- âœ… **Audit Logging** - Track all operations\n- âœ… **Auto-Cleanup** - Expire old data automatically\n\n## ðŸ§ª **Testing Your Setup**\n\n### **Quick Test Commands**\n\n```bash\n# Test all guardrails functionality\nnpm run guardrails:test\n\n# Test API endpoints\nnpm run guardrails:test-api\n\n# Check system health\nnpm run guardrails:health-detailed\n```\n\n### **Expected Test Results**\n\n```\nâœ… Database Connectivity\nâœ… Guardrails Initialization\nâœ… PII Detection System\nâœ… Data Classification\nâœ… Secure Client Operations\nâœ… Validation System\nâœ… Audit Logging System\nâœ… Data Retention System\nâœ… End-to-End Workflow\nâœ… Health Monitoring\nâœ… Performance Impact\n\nðŸ“Š TEST REPORT\n=============\nTotal Tests: 11\nPassed: 11 âœ…\nFailed: 0\nSuccess Rate: 100%\n\nðŸŽ‰ ALL TESTS PASSED! Guardrails system is fully operational.\n```\n\n## ðŸš¨ **Troubleshooting**\n\n### **\"Connection failed\"**\n```bash\n# Check your credentials\necho $SUPABASE_URL\necho $SUPABASE_SERVICE_ROLE_KEY\n\n# Verify in Supabase dashboard:\n# Settings > API > Service Role Key\n```\n\n### **\"Permission denied\"**\n```bash\n# Make sure you're using the SERVICE ROLE key, not the anon key\n# The service role key starts with: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...\n# It should be much longer than the anon key\n```\n\n### **\"Tables not found\"**\n```bash\n# Re-run the setup\nnpm run supabase:setup\n\n# Check Supabase logs\n# Go to: Logs > Database in your Supabase dashboard\n```\n\n### **\"PII scanning not working\"**\n```bash\n# Test PII detection manually\ncurl -X POST -H \"Content-Type: application/json\" \\\n  -d '{\"action\": \"test_scenario\", \"scenario\": \"PII Violation Test\"}' \\\n  http://localhost:3000/api/admin/test-guardrails\n```\n\n## ðŸ”„ **Alternative Setup Methods**\n\n### **Manual SQL Execution**\n\nIf the automatic setup fails, you can run the migrations manually:\n\n```bash\n# Connect to your Supabase database using psql\npsql \"postgresql://postgres:[YOUR_PASSWORD]@db.runniojabssuzfgysbtf.supabase.co:5432/postgres\"\n\n# Run each migration file\n\\i supabase/migrations/001_create_audit_system.sql\n\\i supabase/migrations/002_create_governance_functions.sql\n\\i supabase/migrations/003_create_governance_triggers.sql\n```\n\n### **Using Supabase CLI**\n\n```bash\n# Install Supabase CLI\nnpm install -g supabase\n\n# Link to your project\nsupabase link --project-ref runniojabssuzfgysbtf\n\n# Run migrations\nsupabase db push\n```\n\n## âœ… **Setup Complete Checklist**\n\n- [ ] **Environment variables configured** in `.env.local`\n- [ ] **Setup script runs successfully** (`npm run supabase:setup`)\n- [ ] **All tests pass** (`npm run guardrails:test`)\n- [ ] **Tables visible** in Supabase dashboard\n- [ ] **Health check returns \"healthy\"** (`npm run guardrails:health`)\n- [ ] **PII protection active** (test with guardrails:test-api)\n\n## ðŸš€ **Next Steps**\n\nOnce setup is complete:\n\n1. **Start Development Server**:\n   ```bash\n   npm run dev\n   ```\n\n2. **Check Health Dashboard**: \n   - Look for the guardrails health panel in bottom-right corner (dev mode)\n   - Should show ðŸŸ¢ \"Healthy\" status\n\n3. **Test Integration**:\n   ```bash\n   # Test actual API operations\n   npm run guardrails:test-api\n   \n   # Check compliance\n   npm run guardrails:compliance-report\n   ```\n\n4. **Deploy to Production**:\n   ```bash\n   # Set production environment variables in Vercel\n   npm run deploy:prod\n   ```\n\n---\n\n## ðŸ“ž **Need Help?**\n\n### **Quick Commands Reference**\n```bash\nnpm run supabase:setup          # Initial database setup\nnpm run guardrails:test         # Test all functionality  \nnpm run guardrails:health       # Check system status\nnpm run guardrails:test-api     # Test API endpoints\nnpm run supabase:setup-and-test # Setup + test in one command\n```\n\n### **Useful Links**\n- **Supabase Dashboard**: https://supabase.com/dashboard/project/runniojabssuzfgysbtf\n- **Table Editor**: https://supabase.com/dashboard/project/runniojabssuzfgysbtf/editor\n- **API Settings**: https://supabase.com/dashboard/project/runniojabssuzfgysbtf/settings/api\n- **Logs**: https://supabase.com/dashboard/project/runniojabssuzfgysbtf/logs/database\n\nOnce you see tables in your Supabase dashboard and tests are passing, your OSA application will have enterprise-grade data protection! ðŸŽ‰